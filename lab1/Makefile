CC=g++
CP=mpicxx
CFLAGS=-O2 -c -Wall -std=c++14

SERIES_MAIN_FILE=series/main
SERIES_IMPLEMENTATION_FILE=series/series
SERIES_HEADER=series/linears.h
SERIES_EXE=series/series

PARAL_MAIN_FILE=paral/main
PARAL_IMPLEMENTATION_FILE=paral/paral
PARAL_HEADER=paral/linears.h
PARAL_EXE=paral/paral

PARAL_SPLIT_MAIN_FILE=split/main
PARAL_SPLIT_IMPLEMENTATION_FILE=split/split
PARAL_SPLIT_HEADER=split/linears.h
PARAL_SPLIT_EXE=split/split

SLE_GEN_SOURCE=gen_sle
SLE_GEN_EXE=gen-sle

CHECK_FILE=check

EXEC_EXT=out

all: $(SERIES_EXE).$(EXEC_EXT) $(PARAL_EXE).$(EXEC_EXT) $(PARAL_SPLIT_EXE).$(EXEC_EXT) $(SLE_GEN_EXE).$(EXEC_EXT) $(CHECK_FILE).$(EXEC_EXT)


$(SERIES_EXE).$(EXEC_EXT): $(SERIES_MAIN_FILE).o $(SERIES_IMPLEMENTATION_FILE).o
	$(CC) $(SERIES_MAIN_FILE).o $(SERIES_IMPLEMENTATION_FILE).o -o $(SERIES_EXE).$(EXEC_EXT)

$(SERIES_MAIN_FILE).o: $(SERIES_MAIN_FILE).cpp $(SERIES_HEADER).$(EXEC_EXT)
	$(CC) $(CFLAGS) $(SERIES_MAIN_FILE).cpp -o $(SERIES_MAIN_FILE).o

$(SERIES_IMPLEMENTATION_FILE).o: $(SERIES_IMPLEMENTATION_FILE).cpp $(SERIES_HEADER)
	$(CC) $(CFLAGS) $(SERIES_IMPLEMENTATION_FILE).cpp -o $(SERIES_IMPLEMENTATION_FILE).o


$(PARAL_EXE).$(EXEC_EXT): $(PARAL_MAIN_FILE).o $(PARAL_IMPLEMENTATION_FILE).o
	$(CP) $(PARAL_MAIN_FILE).o $(PARAL_IMPLEMENTATION_FILE).o -o $(PARAL_EXE).$(EXEC_EXT)

$(PARAL_MAIN_FILE).o: $(PARAL_MAIN_FILE).cpp $(PARAL_HEADER).$(EXEC_EXT)
	$(CP) $(CFLAGS) $(PARAL_MAIN_FILE).cpp -o $(PARAL_MAIN_FILE).o

$(PARAL_IMPLEMENTATION_FILE).o: $(PARAL_IMPLEMENTATION_FILE).cpp $(PARAL_HEADER)
	$(CP) $(CFLAGS) $(PARAL_IMPLEMENTATION_FILE).cpp -o $(PARAL_IMPLEMENTATION_FILE).o


$(PARAL_SPLIT_EXE).$(EXEC_EXT): $(PARAL_SPLIT_MAIN_FILE).o $(PARAL_SPLIT_IMPLEMENTATION_FILE).o
	$(CP) $(PARAL_SPLIT_MAIN_FILE).o $(PARAL_SPLIT_IMPLEMENTATION_FILE).o -o $(PARAL_SPLIT_EXE).$(EXEC_EXT)

$(PARAL_SPLIT_MAIN_FILE).o: $(PARAL_SPLIT_MAIN_FILE).cpp $(PARAL_SPLIT_HEADER)
	$(CP) $(CFLAGS) $(PARAL_SPLIT_MAIN_FILE).cpp -o $(PARAL_SPLIT_MAIN_FILE).o

$(PARAL_SPLIT_IMPLEMENTATION_FILE).o: $(PARAL_SPLIT_IMPLEMENTATION_FILE).cpp $(PARAL_SPLIT_HEADER)
	$(CP) $(CFLAGS) $(PARAL_SPLIT_IMPLEMENTATION_FILE).cpp -o $(PARAL_SPLIT_IMPLEMENTATION_FILE).o



$(SLE_GEN_EXE).$(EXEC_EXT): $(SLE_GEN_SOURCE).o
	$(CC) $(SLE_GEN_SOURCE).o -o $(SLE_GEN_EXE).$(EXEC_EXT)

$(SLE_GEN_SOURCE).o: $(SLE_GEN_SOURCE).cpp
	$(CC) $(CFLAGS) $(SLE_GEN_SOURCE).cpp -o $(SLE_GEN_SOURCE).o

$(CHECK_FILE).$(EXEC_EXT): $(CHECK_FILE).o $(SERIES_IMPLEMENTATION_FILE).o
	$(CC) $(CHECK_FILE).o $(SERIES_IMPLEMENTATION_FILE).o -o $(CHECK_FILE).$(EXEC_EXT)

$(CHECK_FILE).o: $(CHECK_FILE).cpp $(SERIES_HEADER)
	$(CC) $(CFLAGS) $(CHECK_FILE).cpp -o $(CHECK_FILE).o

clean:
	rm -rf */*.o
	rm -rf *.o
